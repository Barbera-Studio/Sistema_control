{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>üîê Recuperar Credenciales ‚Äî Acceso Cu√°ntico</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
  <meta name="color-scheme" content="dark" />
  <meta name="theme-color" content="#05080f" />
  <link rel="icon" type="image/png" href="{% static 'img/favicon_qr.png' %}">
  <link href="{% static 'css/output.css' %}" rel="stylesheet" />

  <style>
    :root{
      --bg0:#000000; --bg1:#05080f;
      --glass: rgba(10,20,30,0.82);
      --cyan:#22d3ee; --blue:#2563eb; --purple:#7c3aed; --pink:#ec4899;
      --text:#e6f6ff;
      --danger:#ff4f8b; --success:#00ffcc;
    }

    html, body {
      margin: 0; padding: 0; height: 100%;
      font-family: "Share Tech Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      background: radial-gradient(1200px 800px at 15% 20%, var(--bg1) 0%, var(--bg0) 70%);
      color: var(--text);
      overflow: hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* Fondo orbital */
    .scene { position: fixed; inset: 0; pointer-events: none; z-index: -10; }
    .stars { position: absolute; inset: 0; background: transparent url('{% static "img/stars.png" %}') repeat; animation: moveStars 180s linear infinite; opacity: .35; }
    @keyframes moveStars { from { background-position: 0 0; } to { background-position: -9000px 4500px; } }
    .grid { position: absolute; inset: 0; background-image:
      radial-gradient(circle at 20% 30%, rgba(124,58,237,.12), transparent 55%),
      radial-gradient(circle at 80% 70%, rgba(34,211,238,.12), transparent 55%),
      linear-gradient(transparent 98%, rgba(34,211,238,.15) 100%),
      linear-gradient(90deg, transparent 98%, rgba(124,58,237,.15) 100%);
      background-size: 100% 100%, 100% 100%, 24px 24px, 24px 24px; mix-blend-mode: screen; opacity: .3;
    }

    /* Vista principal */
    .viewport { min-height: 100dvh; display: flex; align-items: center; justify-content: center; position: relative; z-index: 10; }

    /* Tarjeta orbital */
    .card {
      position: relative;
      width: min(600px, 94vw);
      max-height: calc(100dvh - 6vh);
      margin: 0 auto;
      border-radius: 20px;
      background: var(--glass);
      backdrop-filter: blur(20px) saturate(1.06);
      border: 1.6px solid rgba(34,211,238,.35);
      box-shadow: 0 6px 28px rgba(0,0,0,.55), inset 0 0 22px rgba(34,211,238,.08);
      padding: clamp(16px, 4vh, 28px);
      animation: cardPulse 6s ease-in-out infinite;
      display: grid;
      grid-template-rows: auto auto auto auto auto;
      row-gap: clamp(10px, 2.4vh, 18px);
      overflow: hidden;
    }
    @keyframes cardPulse { 0%,100%{ box-shadow: 0 6px 28px rgba(0,0,0,.55), inset 0 0 22px rgba(34,211,238,.08) } 50%{ box-shadow: 0 10px 34px rgba(0,0,0,.65), inset 0 0 30px rgba(124,58,237,.10) } }

    /* Borde hologr√°fico con m√°scara (est√°ndar + WebKit) */
    .card::before{
      content:""; position:absolute; inset:-2px; border-radius:22px; padding:2px; opacity:.6;
      background: conic-gradient(from 180deg at 50% 50%, rgba(34,211,238,.55), rgba(37,99,235,.45), rgba(124,58,237,.55), rgba(236,72,153,.45), rgba(34,211,238,.55));
      animation: hue 18s linear infinite;
      /* Est√°ndar */
      mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      mask-composite: exclude;
      /* WebKit */
      -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      -webkit-mask-composite: xor;
      pointer-events:none;
    }
    @keyframes hue { 0%{ filter:hue-rotate(0deg) } 100%{ filter:hue-rotate(360deg) } }

    /* Icono lock */
    .lock { display: grid; place-items:center; width: clamp(64px, 10vh, 110px); height: clamp(64px, 10vh, 110px); margin: 0 auto; border-radius: 50%;
      background: radial-gradient(closest-side, rgba(34,211,238,.22), rgba(124,58,237,.24));
      box-shadow: 0 0 28px rgba(124,58,237,.35), 0 0 18px rgba(34,211,238,.28) inset; position: relative; animation: lockPulse 5s ease-in-out infinite; }
    @keyframes lockPulse { 0%,100%{transform:scale(1)} 50%{transform:scale(1.04)} }
    .lock::after{ content:"üîê"; font-size: clamp(1.2rem, 3.8vh, 1.9rem); text-shadow: 0 0 10px rgba(34,211,238,.6); }
    .ring { position:absolute; inset:-4px; border-radius:50%; border: 2px dashed rgba(34,211,238,.45); animation: spin 16s linear infinite; }
    @keyframes spin { from{transform:rotate(0)} to{transform:rotate(360deg)} }

    /* Titulares */
    .title { text-align:center; font-weight: 900; letter-spacing:.08em; text-transform: uppercase; font-size: clamp(1.2rem, 4.6vh, 2rem); background: linear-gradient(90deg, var(--cyan), var(--blue), var(--purple)); -webkit-background-clip:text; background-clip:text; color: transparent; text-shadow: 0 0 16px rgba(34,211,238,.28); animation: shimmer 3.2s ease-in-out infinite; margin: 0; }
    @keyframes shimmer { 0%,100%{opacity:.96} 50%{opacity:1} }
    .subtitle { text-align:center; font-size: clamp(.78rem, 2.4vh, .95rem); color: rgba(226,245,255,.88); letter-spacing: .16em; text-transform: uppercase; margin: 0; }

    /* Mensajes */
    .messages { text-align:center; margin: 0; }
    .message { font-size: clamp(.82rem, 2.2vh, .95rem); margin: 0; }
    .success { color: var(--success); font-weight: 700; text-shadow: 0 0 10px var(--success); }
    .error   { color: var(--danger); font-weight: 700; text-shadow: 0 0 10px var(--danger); }
    .link { display: block; margin-top: .26rem; font-size: clamp(.76rem, 2vh, .9rem); color: #00ffe0; text-shadow: 0 0 8px #00ffe0, 0 0 16px #00ffe0; word-break: break-word; }

    /* Acci√≥n */
    .action { display:flex; flex-direction:column; align-items:center; gap: clamp(14px, 2.6vh, 20px); }

    /* Campo de email: compacto, con input debajo y m√°s m√°rgenes para el helper */
    .input-wrap {
      position: relative;
      width: 100%;
      max-width: 380px;
      margin: 0 auto;
    }
    .glow {
      position: absolute; inset: -1px; border-radius: 14px; pointer-events: none; opacity: .6;
      background: conic-gradient(from 120deg at 50% 50%, rgba(34,211,238,.45), rgba(37,99,235,.35), rgba(124,58,237,.45), rgba(236,72,153,.35), rgba(34,211,238,.45));
      filter: blur(8px);
      transition: opacity .18s ease, filter .18s ease;
    }
    /* Encabezado del campo: icono email + etiqueta + tick */
    .input-head {
      display: grid;
      grid-template-columns: auto 1fr auto;
      align-items: center;
      column-gap: 10px;
      padding: 10px 12px;
      border: 1.6px solid rgba(34,211,238,.35);
      border-bottom: 0;
      border-top-left-radius: 14px;
      border-top-right-radius: 14px;
      background: rgba(5,8,15,.65);
      box-shadow: inset 0 0 12px rgba(34,211,238,.08);
    }
    .icon { width: 18px; height: 18px; filter: drop-shadow(0 0 6px rgba(34,211,238,.5)); }
    .label-inline {
      font-size: .78rem; letter-spacing: .12em; text-transform: uppercase;
      color: rgba(226,245,255,.86);
    }
    .icon.tick { width: 18px; height: 18px; pointer-events: none; }

    /* Cuerpo del campo: input debajo del encabezado */
    .input-body {
      border: 1.6px solid rgba(34,211,238,.35);
      border-top: 0;
      border-bottom-left-radius: 14px;
      border-bottom-right-radius: 14px;
      background: rgba(5,8,15,.65);
      box-shadow: inset 0 0 12px rgba(34,211,238,.08);
      padding: 12px 14px;
    }
    .input {
      width: 100%;
      border: 0; outline: none; background: transparent;
      color: var(--text);
      font-size: 1rem;
      letter-spacing: .02em;
      caret-color: var(--cyan);
      padding: 2px 0;
    }

    /* Helper con m√°s aire arriba y abajo */
    .helper {
      width: 100%;
      max-width: 380px;
      margin: 16px auto;        /* m√°s margen superior e inferior */
      font-size: .86rem;
      color: #cfd8dc;
      text-align: center;
      font-style: italic;
      line-height: 1.5;
    }
    .valid { color: var(--success); text-shadow: 0 0 8px var(--success); }
    .invalid { color: var(--danger); text-shadow: 0 0 8px var(--danger); }

    /* Bot√≥n */
    .btn {
      display:inline-flex; align-items:center; justify-content:center;
      width: 100%; max-width: 380px;
      padding: clamp(10px, 2.4vh, 16px);
      font-size: clamp(1rem, 2.4vh, 1.12rem);
      font-weight: 800; letter-spacing: .06em; text-transform: uppercase;
      border: 0; border-radius: 14px; color: #fff; cursor: pointer;
      background: linear-gradient(90deg, var(--cyan), var(--blue), var(--purple), var(--pink), var(--cyan));
      background-size: 260% 260%;
      box-shadow: 0 10px 22px rgba(37,99,235,.25), 0 0 22px rgba(34,211,238,.35);
      animation: bgMove 6.2s linear infinite;
      transition: transform .18s ease, box-shadow .18s ease, opacity .18s ease, filter .18s ease;
    }
    .btn:hover { transform: translateY(-1px) scale(1.015); box-shadow: 0 12px 26px rgba(37,99,235,.35), 0 0 28px rgba(34,211,238,.45); filter: saturate(1.08); }
    .btn:active { transform: translateY(0) scale(.995); }
    @keyframes bgMove { 0%{ background-position: 0% 50% } 50%{ background-position: 100% 50% } 100%{ background-position: 0% 50% } }

    .hint { margin: 0; text-align:center; font-size: clamp(.8rem, 2vh, .95rem); color: #cfd8dc; font-style: italic; }

    /* Compresi√≥n inteligente por altura */
    @media (max-height: 700px) {
      .card { max-height: calc(100dvh - 4vh); row-gap: clamp(6px, 1.8vh, 12px); padding: clamp(12px, 3.6vh, 22px); }
      .lock { width: clamp(58px, 9vh, 96px); height: clamp(58px, 9vh, 96px); }
      .ring { inset:-3px; border-width: 1.5px; }
      .title { font-size: clamp(1.05rem, 4vh, 1.75rem); }
      .subtitle { font-size: clamp(.74rem, 2vh, .88rem); }
      .btn { max-width: 340px; padding: clamp(9px, 2vh, 14px); font-size: clamp(.95rem, 2vh, 1.06rem); }
      .helper { margin: 14px auto; } /* mantiene aire en pantallas bajas */
    }
    @media (max-height: 560px) {
      .card { max-height: calc(100dvh - 3vh); row-gap: clamp(4px, 1.2vh, 10px); padding: clamp(10px, 3vh, 18px); }
      .lock { width: clamp(50px, 8vh, 84px); height: clamp(50px, 8vh, 84px); }
      .ring { inset:-2px; border-width: 1.4px; }
      .title { margin-top: 2px; font-size: clamp(.98rem, 3.6vh, 1.6rem); }
      .hint { font-size: clamp(.76rem, 1.8vh, .9rem); }
      .helper { margin: 12px auto; }
    }

    /* Motion-safe */
    @media (prefers-reduced-motion: reduce){ .stars, .grid, .card::before, .lock, .ring, .title, .btn { animation: none !important; } }

    /* Seguridad visual */
    *, *::before, *::after { box-sizing: border-box; }
  </style>
</head>
<body>
  <!-- Fondo orbital -->
  <div class="scene" aria-hidden="true">
    <div class="stars"></div>
    <div class="grid"></div>
  </div>

  <!-- Vista centrada y ajustada al alto -->
  <div class="viewport">
    <section class="card" role="region" aria-labelledby="titulo-recuperacion">
      <div class="lock"><div class="ring"></div></div>

      <h1 id="titulo-recuperacion" class="title">Recuperaci√≥n Cu√°ntica</h1>
      <p class="subtitle">Restablece tu acceso multiversal</p>

      {% if messages %}
        <div class="messages" role="status" aria-live="polite">
          {% for message in messages %}
            <p class="message {{ message.tags }}">{{ message|safe }}</p>
          {% endfor %}
        </div>
      {% endif %}

      {% if enlace_generado %}
        <div class="messages success" role="status" aria-live="polite">
          üîì Enlace generado:
          <a href="{{ enlace_generado }}" class="link" rel="noopener noreferrer">{{ enlace_generado }}</a>
        </div>
      {% endif %}

      <!-- Acci√≥n: formulario -->
      <div class="action">
        <form method="post" action="{% url 'usuarios:password_reset' %}" novalidate aria-label="Formulario de recuperaci√≥n">
          {% csrf_token %}

          <div class="input-wrap">
            <span class="glow" aria-hidden="true"></span>

            <!-- Encabezado: iconos + etiqueta (misma altura) -->
            <div class="input-head">
              <!-- Icono email -->
              <svg class="icon" aria-hidden="true" viewBox="0 0 24 24" fill="none">
                <path d="M3 7a3 3 0 0 1 3-3h12a3 3 0 0 1 3 3v10a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V7Z" stroke="#22d3ee" stroke-width="1.6"/>
                <path d="M4 7l8 6 8-6" stroke="#7c3aed" stroke-width="1.6"/>
              </svg>

              <!-- Etiqueta alineada -->
              <span class="label-inline">Correo registrado</span>

              <!-- Tick verde -->
              <svg class="icon tick" aria-hidden="true" viewBox="0 0 24 24" fill="none">
                <circle cx="12" cy="12" r="10" stroke="#2563eb" stroke-width="1.2" opacity=".45"/>
                <path d="M8 12l2.5 2.5L16 9" stroke="#00ffcc" stroke-width="2" opacity=".0" id="checkmark"/>
              </svg>
            </div>

            <!-- Cuerpo: input debajo del encabezado -->
            <div class="input-body">
              <label for="email" class="sr-only">Correo registrado</label>
              <input
                id="email"
                class="input"
                type="email"
                name="email"
                autocomplete="email"
                inputmode="email"
                required
                aria-required="true"
                aria-describedby="email-helper"
                placeholder="tu-correo@dominio.com" />
            </div>

            <p id="email-helper" class="helper">Introduce el correo vinculado a tu cuenta. Te enviaremos un enlace seguro.</p>
          </div>

          <button type="submit" class="btn" aria-label="Generar enlace de recuperaci√≥n">
            üß¨ Generar enlace de recuperaci√≥n
          </button>
        </form>

        <p class="hint">Pulsa el bot√≥n tras introducir tu correo. Si no ves el correo, revisa spam.</p>
      </div>
    </section>
  </div>

  <script>
    // Microinteracci√≥n: brillo y validaci√≥n visual (no bloquea env√≠o)
    (function(){
      const email = document.getElementById('email');
      const glow = document.querySelector('.glow');
      const helper = document.getElementById('email-helper');
      const check = document.getElementById('checkmark');

      function updateState(){
        const val = email.value.trim();
        const ok = val.length > 5 && val.includes('@');

        glow.style.opacity = ok ? '0.85' : '0.6';
        glow.style.filter = ok ? 'blur(12px)' : 'blur(8px)';

        helper.classList.toggle('valid', ok);
        helper.classList.toggle('invalid', !ok);
        helper.textContent = ok
          ? 'Perfecto. Te enviaremos el enlace de recuperaci√≥n.'
          : 'Introduce el correo vinculado a tu cuenta. Te enviaremos un enlace seguro.';

        if (check) check.style.opacity = ok ? '1' : '0';
      }

      email && email.addEventListener('input', updateState);
      email && email.addEventListener('focus', updateState);
      email && email.addEventListener('blur', updateState);
    })();
  </script>
</body>
</html>
